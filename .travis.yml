jobs:
  include:
    - os: windows
      language: bash

    - os: osx
      language: bash

    - os: linux
      language: android
      android:
        components:
          - build-tools-30.0.0-rc1
          - android-29

env:
  global:
    - GRAVIS_REPO="https://github.com/DanySK/Gravis-CI.git"
    - GRAVIS="$HOME/gravis"
    - JDK="adopt@1.8.0-242"

before_install:
  - travis_retry git clone --depth 1 $GRAVIS_REPO $GRAVIS
  - source $GRAVIS/install-jdk
  - chmod +x gradlew

script: ./gradlew check --console=plain --parallel

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - "$HOME/.gradle/caches/"
    - "$HOME/.gradle/wrapper/"
    - "$HOME/.konan/cache/"

deploy:
  provider: script
  script: ./gradlew bintrayUpload --console=plain --parallel
  skip_cleanup: true
  on:
    tags: true
    branch: master


